/*! vokal-ng-api Copyright Vokal 2015 */
!function(a,b){"function"==typeof define&&define.amd?define("vokal-ng-api",["humps"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("humps")):b(humps)}(this,function(a){angular.module("vokal.API",["vokal.Humps"]).factory("API",["$http","$rootScope","$q","Humps",function(a,b,c,d){"use strict";function e(a){try{return decodeURIComponent(a)}catch(b){}}function f(a){var b,c,d={};return angular.forEach((a||"").split("&"),function(a){if(a&&(b=a.replace(/\+/g,"%20").split("="),c=e(b[0]),angular.isDefined(c))){var f=angular.isDefined(b[1])?e(b[1]):!0;hasOwnProperty.call(d,c)?angular.isArray(d[c])?d[c].push(f):d[c]=[d[c],f]:d[c]=f}}),d}function g(a){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,"+").replace(/%7B/g,"{").replace(/%7D/g,"}").replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/%22/g,'"').replace(/%5C/g,"\\")}var h=function(a){var b=a.split("?");return 1===b.length?{}:f(b[1])},i=function(a,b){if(!angular.isObject(b))return a;b=angular.extend({},h(a),b||{}),a=a.split("?")[0];for(var c=Object.keys(b),d=[],e=0;e<c.length;e++){var f=c[e],i=b[f];angular.isObject(i)&&(i=JSON.stringify(i)),d.push(g(f)+"="+g(i))}return a+(d.length?"?"+d.join("&"):"")},j=function(a){this.globalHeaders=angular.copy(this.constructor.prototype.globalHeaders),a&&("undefined"!=typeof a.globalHeaders&&(this.globalHeaders=angular.copy(a.globalHeaders)),"undefined"!=typeof a.rootPath&&(this.rootPath=a.rootPath),"undefined"!=typeof a.transformHumps&&(this.transformHumps=a.transformHumps),"undefined"!=typeof a.cancelOnRouteChange&&(this.cancelOnRouteChange=a.cancelOnRouteChange),"undefined"!=typeof a.unauthorizedInterrupt&&(this.unauthorizedInterrupt=a.unauthorizedInterrupt))};return j.prototype.globalHeaders={},j.prototype.rootPath="",j.prototype.transformHumps=!0,j.prototype.cancelOnRouteChange=!1,j.prototype.unauthorizedInterrupt=!0,j.prototype.extendHeaders=function(a){angular.extend(this.globalHeaders,a)},j.prototype.setKey=function(a){this.globalHeaders.AUTHORIZATION=String(a)},j.prototype.getKey=function(){return this.globalHeaders.AUTHORIZATION},j.prototype.queryUrl=i,j.prototype.apiRequest=function(e,f,g){var h=this,i=c.defer(),j={method:e,url:this.rootPath+f,headers:this.globalHeaders,data:g||{},timeout:i.promise};if("postFile"===e?(this.globalHeaders["Content-Type"]=void 0,j.method="post",j.transformRequest=angular.identity):this.transformHumps&&(this.globalHeaders["Content-Type"]="application/json",j.transformRequest=d.requestToSnake(a.defaults.transformRequest),j.transformResponse=d.responseToCamel(a.defaults.transformResponse)),a(j).success(function(a,c){b.$broadcast("APIRequestComplete",j,a,c),b.$broadcast("APIRequestSuccess",j,a,c),i.resolve({data:a,options:j,status:c})}).error(function(a,c){b.$broadcast("APIRequestComplete",j,a,c),(401!==c&&403!==c||(b.$broadcast("APIRequestUnauthorized",j,a,c),!h.unauthorizedInterrupt))&&(b.$broadcast("APIRequestError",j,a,c),i.reject({data:a,options:j,status:c}))}),b.$broadcast("APIRequestStart",j),this.cancelOnRouteChange)var k=b.$on("$routeChangeSuccess",function(){i.promise.$cancel("Request canceled",j),k()}),l=b.$on("APIRequestComplete",function(){k(),l()});return i.promise.$cancel=function(a,c){b.$broadcast("APIRequestCanceled",c,a),i.reject({data:a||"Request cancelled",options:c})},i.promise},j.prototype.$get=function(a,b){return this.apiRequest("get",i(a,b))},j.prototype.$post=function(a,b){return this.apiRequest("post",a,b)},j.prototype.$postFile=function(a,b){return this.apiRequest("postFile",a,b)},j.prototype.$put=function(a,b){return this.apiRequest("put",a,b)},j.prototype.$patch=function(a,b){return this.apiRequest("patch",a,b)},j.prototype.$delete=function(a){return this.apiRequest("delete",a)},j}]),angular.module("vokal.Humps",[]).service("Humps",function(){"use strict";var b=function(a,b){return a=angular.isArray(a)?a:[a],a.concat(b)};this.responseToCamel=function(c){return b(c,function(b){return a.camelizeKeys(b)})},this.requestToSnake=function(c){return b(c,function(b){return"string"==typeof b?JSON.stringify(a.decamelizeKeys(JSON.parse(b),"_")):a.decamelizeKeys(b,"_")})}})});