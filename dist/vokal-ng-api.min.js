/*! vokal-ng-api Copyright Vokal 2015 */
angular.module("vokal.API",["vokal.Humps"]).provider("API",function(){"use strict";function a(a){try{return decodeURIComponent(a)}catch(b){}}function b(b){var c,d,e={};return angular.forEach((b||"").split("&"),function(b){if(b&&(c=b.replace(/\+/g,"%20").split("="),d=a(c[0]),angular.isDefined(d))){var f=angular.isDefined(c[1])?a(c[1]):!0;hasOwnProperty.call(e,d)?angular.isArray(e[d])?e[d].push(f):e[d]=[e[d],f]:e[d]=f}}),e}function c(a){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,"+").replace(/%7B/g,"{").replace(/%7D/g,"}").replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/%22/g,'"').replace(/%5C/g,"\\")}var d={},e="",f=this;this.transformHumps=!0,this.cancelOnRouteChange=!1,this.unauthorizedInterrupt=!0,this.setHeaders=function(a){angular.extend(d,a)},this.setRootPath=function(a){e=String(a)},this.$get=["$http","$rootScope","$q","Humps",function(a,g,h,i){var j=function(b,c,j){var k=h.defer(),l={method:b,url:e+c,headers:d,data:j||{},timeout:k.promise};if("postFile"===b?(d["Content-Type"]=void 0,l.method="post",l.transformRequest=angular.identity):f.transformHumps&&(d["Content-Type"]="application/json",l.transformRequest=i.requestToSnake(a.defaults.transformRequest),l.transformResponse=i.responseToCamel(a.defaults.transformResponse)),a(l).success(function(a,b){g.$broadcast("APIRequestComplete",l,a,b),g.$broadcast("APIRequestSuccess",l,a,b),k.resolve(a)}).error(function(a,b){g.$broadcast("APIRequestComplete",l,a,b),401===b||403===b?(g.$broadcast("APIRequestUnauthorized",l,a,b),f.unauthorizedInterrupt||(g.$broadcast("APIRequestError",l,a,b),k.reject(a,b))):(g.$broadcast("APIRequestError",l,a,b),k.reject(a,b))}),g.$broadcast("APIRequestStart",l),f.cancelOnRouteChange)var m=g.$on("$routeChangeSuccess",function(){k.promise.$cancel("Request canceled",l),m()}),n=g.$on("APIRequestComplete",function(){m(),n()});return k.promise.$cancel=function(a,b){g.$broadcast("APIRequestCanceled",b,a),k.reject(a||"Request cancelled",b)},k.promise},k=function(a){var c=a.split("?");return 1===c.length?{}:b(c[1])},l=function(a,b){if(!angular.isObject(b))return a;b=angular.extend({},k(a),b||{}),a=a.split("?")[0];for(var d=Object.keys(b),e=[],f=0;f<d.length;f++){var g=d[f],h=b[g];angular.isObject(h)&&(h=JSON.stringify(h)),e.push(c(g)+"="+c(h))}return a+(e.length?"?"+e.join("&"):"")};return{setKey:function(a){d.AUTHORIZATION=String(a)},getKey:function(){return d.AUTHORIZATION},queryUrl:l,$get:function(a,b){return j("get",l(a,b))},$post:function(a,b){return j("post",a,b)},$postFile:function(a,b){return j("postFile",a,b)},$put:function(a,b){return j("put",a,b)},$patch:function(a,b){return j("patch",a,b)},$delete:function(a){return j("delete",a)}}}]}),angular.module("vokal.Humps",[]).service("Humps",function(){"use strict";var a=function(a,b){return a=angular.isArray(a)?a:[a],a.concat(b)};this.responseToCamel=function(b){return a(b,function(a){return humps.camelizeKeys(a)})},this.requestToSnake=function(b){return a(b,function(a){return"string"==typeof a?JSON.stringify(humps.decamelizeKeys(JSON.parse(a),"_")):humps.decamelizeKeys(a,"_")})}});