angular.module("vokal.Humps",[]).service("Humps",function(){"use strict";var g=function(a,b){a=angular.isArray(a)?a:[a];return a.concat(b)};this.responseToCamel=function(b){return(g(b,function(a){return humps.camelizeKeys(a)}))};this.requestToSnake=function(b){return(g(b,function(a){if(typeof(a)==="string"){return JSON.stringify(humps.decamelizeKeys(JSON.parse(a),"_"))}return humps.decamelizeKeys(a,"_")}))}});angular.module("vokal.API",["vokal.Humps"]).provider("API",function(){"use strict";var j={};var n="";var l=this;this.transformHumps=true;this.cancelOnRouteChange=false;this.unauthorizedInterrupt=true;this.setHeaders=function(a){angular.extend(j,a)};this.setRootPath=function(a){n=String(a)};function o(a){try{return decodeURIComponent(a)}catch(e){}}function t(g){var f={},h,c;angular.forEach((g||"").split("&"),function(a){if(a){h=a.replace(/\+/g,"%20").split("=");c=o(h[0]);if(angular.isDefined(c)){var b=angular.isDefined(h[1])?o(h[1]):true;if(!hasOwnProperty.call(f,c)){f[c]=b}else if(angular.isArray(f[c])){f[c].push(b)}else{f[c]=[f[c],b]}}}});return f}function p(a){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,"+").replace(/%7B/g,"{").replace(/%7D/g,"}").replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/%22/g,'"').replace(/%5C/g,"\\")}this.$get=["$http","$rootScope","$q","Humps",function(m,i,u,q){var k=function(g,f,h){var c=u.defer();var d={method:g,url:n+f,headers:j,data:h||{},timeout:c.promise};if(g==="postFile"){j["Content-Type"]=undefined;d.method="post";d.transformRequest=angular.identity}else if(l.transformHumps){j["Content-Type"]="application/json";d.transformRequest=q.requestToSnake(m.defaults.transformRequest);d.transformResponse=q.responseToCamel(m.defaults.transformResponse)}m(d).success(function(a,b){i.$broadcast("APIRequestComplete",d,a,b);i.$broadcast("APIRequestSuccess",d,a,b);c.resolve(a)}).error(function(a,b){i.$broadcast("APIRequestComplete",d,a,b);if(b===401||b===403){i.$broadcast("APIRequestUnauthorized",d,a,b);if(!l.unauthorizedInterrupt){i.$broadcast("APIRequestError",d,a,b);c.reject(a,b)}}else{i.$broadcast("APIRequestError",d,a,b);c.reject(a,b)}});i.$broadcast("APIRequestStart",d);if(l.cancelOnRouteChange){var r=i.$on("$routeChangeSuccess",function(){c.promise.$cancel("Request canceled",d);r()});var v=i.$on("APIRequestComplete",function(){r();v()})}c.promise.$cancel=function(a,b){i.$broadcast("APIRequestCanceled",b,a);c.reject(a||"Request cancelled",b)};return c.promise};var w=function(a){var b=a.split("?");if(b.length===1){return{}}return t(b[1])};var s=function(a,b){if(!angular.isObject(b)){return a}b=angular.extend({},w(a),b||{});a=a.split("?")[0];var g=Object.keys(b);var f=[];for(var h=0;h<g.length;h++){var c=g[h];var d=b[c];if(angular.isObject(d)){d=JSON.stringify(d)}f.push(p(c)+"="+p(d))}return a+(f.length?"?"+f.join("&"):"")};return{setKey:function(a){j.AUTHORIZATION=String(a)},getKey:function(){return j.AUTHORIZATION},queryUrl:s,$get:function(a,b){return k("get",s(a,b))},$post:function(a,b){return k("post",a,b)},$postFile:function(a,b){return k("postFile",a,b)},$put:function(a,b){return k("put",a,b)},$patch:function(a,b){return k("patch",a,b)},$delete:function(a){return k("delete",a)}}}]});
